var t={d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{A:()=>s});class s{static State={Closed:"closed",Opening:"opening",Open:"open",Closing:"closing"};onbin(t){}ontext(t){}onopen(){}onclose(){}onchange(t){}onerror(t){}constructor(t={}){this.cfg={ip:"localhost",port:81,proto:"",secure:!1,reconnect:1e3,...t},this.ws=null,this.retry=!1}config(t={}){this.cfg={...this.cfg,...t}}opened(){return this.ws&&this.ws.readyState===WebSocket.OPEN}open(){this.cfg.reconnect&&(this.retry=!0),this._open()}_open(){if(this.ws&&(this.ws.readyState===WebSocket.CONNECTING||this.ws.readyState===WebSocket.OPEN))return;let t=this.cfg.secure||"https:"===location.protocol?"wss":"ws";this._change(s.State.Opening),this.ws=new WebSocket(`${t}://${this.cfg.ip}:${this.cfg.port}/`,[this.cfg.proto]),this.ws.binaryType="arraybuffer";const e=this.ws;let o=null;this.retry&&(o=setTimeout(()=>{e.readyState===WebSocket.CONNECTING&&e.close()},this.cfg.reconnect)),e.onopen=()=>{clearTimeout(o),this._change(s.State.Open)},e.onclose=()=>{clearTimeout(o),this.ws===e&&(this.ws=null),this._change(s.State.Closed),this.retry&&setTimeout(()=>this._open(),this.cfg.reconnect)},e.onmessage=t=>{"string"==typeof t.data?this.ontext(t.data):this.onbin(t.data)},e.onerror=t=>{this.onerror("[WS] Error")}}close(){if(this.retry=!1,this.ws){this._change(s.State.Closing);const t=this.ws;this.ws=null,t.close()}}sendBin(t){this.opened()&&this.ws.send(t)}sendText(t){this.opened()&&this.ws.send(t)}_change(t){switch(this.onchange(t),t){case s.State.Open:this.onopen();break;case s.State.Closed:this.onclose()}}}const o=e.A;export{o as default};